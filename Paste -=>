# MenuTitle: Paste -=>
# -*- coding: utf-8 -*-
from AppKit import NSPasteboard, NSUTF8StringEncoding
Glyphs.clearLog()

def paste_anchors_keep_coordinates(measure_from_right = False):
	pasteboard = NSPasteboard.generalPasteboard()
	typeName = pasteboard.availableTypeFromArray_(["Glyphs elements pasteboard type"])
	if typeName == "Glyphs elements pasteboard type":
		Data = pasteboard.dataForType_(typeName)
		theText = NSString.alloc().initWithData_encoding_(Data, NSUTF8StringEncoding)
		Dictionary = theText.propertyList()
		if Dictionary is not None:
			source_glyph = Glyphs.font.glyphs[Dictionary['glyph']]
			for source_layer in source_glyph.layers:
				for anchor_data in Dictionary['anchors']:
					anchor = source_layer.anchors[anchor_data['name']]
					from_right = source_layer.width - anchor.x
												
					# paste to layers
					for sel_layer in Glyphs.font.selectedLayers:
						layer = sel_layer.parent.layers[source_layer.layerId]
						if not layer:
							continue
						new_anchor = anchor.copy()
						layer.anchors.append(new_anchor)

						if measure_from_right:
							new_anchor.x = layer.width - from_right

						
# copy anchor(s) and run the script to paste to all selected layer[s]
paste_anchors_keep_coordinates(measure_from_right = True) # True or False
